@using Microsoft.AspNetCore.Identity
@using VZTest.Models.Test
@inject SignInManager<IdentityUser> signInManager
@model IEnumerable<TestStatistics>
@{
    ViewData["Title"] = "Публичные тесты";
}

<script>
    function StarToggle(id)
    {
        var verificationValue = document.getElementsByName('__RequestVerificationToken')[0].getAttribute('value');
        var starred = document.getElementById("star-toggle-"+id) == null;
        $.ajax({
                type: "POST",
                url: "/Test/StarToggle/",
                data: {id: id, starred: starred, __RequestVerificationToken: verificationValue },
                success: function(data)
                {
                    if (starred)
                    {
                        var element = document.getElementById("unstar-toggle-"+id);
                        element.setAttribute('class', 'btn btn-outline-success');
                        element.innerHTML = "<small>" + data + " <i class=\"bi bi-star\"></i></small>";
                        element.setAttribute('id', "star-toggle-"+id);
                    }
                    else
                    {
                        var element = document.getElementById("star-toggle-"+id);
                        element.setAttribute('class', 'btn btn-success');
                        element.innerHTML = "<small>" + data + " <i class=\"bi bi-star\"></i></small>";
                        element.setAttribute('id', "unstar-toggle-"+id);
                    }
                }});
    }
</script>

<h2><i class="bi bi-list-check"></i> @ViewData["Title"]</h2>
<hr>

@if (!signInManager.IsSignedIn(User))
{
    <h5>Войдите в свой аккаунт</h5>
    return;
}

@if (Model == null || Model.Count() == 0)
{
    <h5>Здесь пока пусто</h5>
    return;
}
<form></form> @*FOR VALIDATION TOKEN*@
<div class="list-group">
    @foreach (TestStatistics testStat in Model)
    {
        <div class="list-group-item list-group-item-action flex-column align-items-start">
            <div class="d-flex w-100 justify-content-between">
                <a asp-controller="Test" asp-action="Preview" asp-route-id="@testStat.Test.Id">
                    <h5 class="mb-1">@testStat.Test.Title</h5>
                </a>
                @if (testStat.CurrectUserStarred)
                {
                    <a id="unstar-toggle-@testStat.Test.Id" class="btn btn-success" onclick="StarToggle(@testStat.Test.Id);"><small>@testStat.StarsCount <i class="bi bi-star"></i></small></a>
                }
                else
                {
                    <a id="star-toggle-@testStat.Test.Id" class="btn btn-outline-success" onclick="StarToggle(@testStat.Test.Id);"><small>@testStat.StarsCount <i class="bi bi-star"></i></small></a>
                }
            </div>
            @if (testStat.Test.Description != null)
            {
                <p class="mb-1">@testStat.Test.Description</p>
            }
            else
            {
                <p class="mb-1">Без описания</p>
            }
            <small>ID:@testStat.Test.Id</small>
        </div>
    }
</div>